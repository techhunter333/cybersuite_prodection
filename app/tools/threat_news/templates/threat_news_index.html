{% extends "base.html" %}

{% block header %}Threat News Viewer{% endblock %}
{% block content %}
    
    <div class="tool-wrapper" style="max-width: 800px;">
        
        <div style="text-align: center; margin-bottom: 40px;">
            <div style="font-size: 3.8rem; color: var(--accent); margin-bottom: 16px;">
                <i class="fas fa-newspaper"></i>
            </div>
            <h1 style="margin: 0; color: var(--text-main); font-size: 2.4rem; font-weight: 800;">Cybersecurity Threat News</h1>
            <p style="color: var(--text-muted); font-size: 1.2rem; margin-top: 8px;">
                Aggregated news and alerts from public sources
            </p>
        </div>

        <div style="text-align: center; margin-bottom: 40px;">
            <button type="button" id="fetch-feeds-btn" class="btn-primary">
                <i class="fas fa-sync-alt"></i> Fetch Latest Feeds
            </button>
        </div>
        
        <div id="status-area-ti" style="text-align: center; margin: 30px 0;">
            <div id="loading-spinner-ti" class="spinner" style="display: none;"></div>
            <p id="status-message-ti" style="font-weight: 700; color: var(--accent); font-size: 1.1rem; margin-top: 16px;"></p>
        </div>
        
        <div id="feed-errors-display" style="display: none;">
            <h4 style="color: #ca8a04; font-weight: 700; margin-bottom: 12px;">
                <i class="fas fa-exclamation-triangle"></i> Feed Fetching Issues:
            </h4>
            <ul id="feed-errors-list"></ul>
        </div>

        <div id="feed-items-container">
            <h2 style="border-bottom: 2px solid var(--border); padding-bottom: 16px; margin: 40px 0 24px; font-size: 1.8rem; font-weight: 800;">
                Aggregated Items
            </h2>
            <div id="total-fetched-info" style="color: var(--text-muted); font-size: 1rem; margin-bottom: 24px; font-weight: 500;"></div>
            
            <ul id="feed-list">
                <p id="no-feeds-message" style="text-align: center; color: var(--text-muted); padding: 60px 20px; font-size: 1.2rem; font-weight: 500;">
                    Click "Fetch Latest Feeds" to load data.
                </p>
            </ul>
        </div>
        
        <div class="source-info">
            {% if feed_sources_keys %}
                <p style="font-weight: 700; color: var(--text-main); margin-bottom: 8px;">
                    <strong>Data Sources:</strong> {{ feed_sources_keys | join(', ') }}
                </p>
            {% endif %}
            <p>This tool aggregates publicly available RSS feeds. Content accuracy depends on original sources.</p>
        </div>

    </div>

    <style>
        /* Fetch Button - Compact & Elegant */
        #fetch-feeds-btn {
            padding: 16px 36px;
            font-size: 1.1rem;
            font-weight: 700;
            border-radius: 14px;
            box-shadow: 0 6px 16px rgba(99,102,241,0.3);
            transition: all 0.3s ease;
        }

        #fetch-feeds-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 24px rgba(99,102,241,0.4);
        }

        /* Smaller, Compact Feed Cards - Matches Your Edited Screenshot */
        #feed-list { 
            list-style: none; 
            padding: 0; 
            margin-top: 20px; 
        }

        .feed-item {
            background: var(--bg-body);
            border: 1px solid var(--border);
            border-radius: 16px;
            margin-bottom: 16px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            transition: all 0.3s ease;
        }

        .feed-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 20px rgba(99,102,241,0.1);
            border-color: var(--accent);
        }
        
        .feed-item a {
            display: block;
            padding: 18px 24px;
            text-decoration: none;
            color: inherit;
        }

        .item-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .item-source {
            font-weight: 700;
            color: var(--accent);
            font-size: 0.95rem;
        }

        .item-date {
            color: var(--text-muted);
            font-size: 0.85rem;
        }
        
        .item-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-main);
            margin: 0 0 10px 0;
            line-height: 1.4;
        }

        .item-summary {
            font-size: 0.95rem;
            color: var(--text-muted);
            line-height: 1.6;
            margin: 0;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        /* Loading Spinner */
        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid var(--border);
            border-top-color: var(--accent);
            border-radius: 50%;
            animation: spin 1s ease-in-out infinite;
            margin: 40px auto;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Errors Display */
        #feed-errors-display {
            background: rgba(234,179,8,0.08);
            border: 1px solid #eab308;
            border-radius: 14px;
            padding: 20px;
            margin: 24px 0;
            color: #ca8a04;
        }

        #feed-errors-display h4 {
            margin-top: 0;
            margin-bottom: 12px;
            font-size: 1.1rem;
            font-weight: 700;
        }

        /* No Feeds Message */
        #no-feeds-message {
            background: var(--bg-body);
            padding: 50px 20px;
            border-radius: 16px;
            border: 2px dashed var(--border);
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--text-muted);
        }

        /* Source Info */
        .source-info {
            margin-top: 50px;
            padding: 24px;
            background: var(--bg-body);
            border-radius: 16px;
            border-left: 4px solid var(--accent);
            box-shadow: 0 4px 12px rgba(0,0,0,0.06);
            font-size: 0.9rem;
        }

        .source-info p:first-child {
            font-weight: 700;
            color: var(--text-main);
            margin-bottom: 10px;
            font-size: 1rem;
        }
    </style>
{% endblock %}

{% block scripts %}
    <script src="{{ url_for('threat_news.static', filename='script.js') }}"></script>
{% endblock %}